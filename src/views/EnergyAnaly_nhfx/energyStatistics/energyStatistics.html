<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>能耗统计</title>
    <link rel="stylesheet" href="./../../../layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="./../../../layuiadmin/style/admin.css" media="all">
    <link rel="stylesheet" href="./../../../layuiadmin/plugin/element.css">
    <link rel="stylesheet" href="./../../../layuiadmin/style/energyStatistics.css">
    <style>
        .AdminArea {
            position: relative;
        }

        .AdminArea .Areashow {
            position: absolute;
            width: 100%;
            border: 1px solid #e6e6e6;
            /* border-radius: 4px; */
            z-index: 999;
            /* height: 200px; */
            background-color: #fff;

        }

        .AdminArea .layui-icon {
            position: absolute;
            top: -5px;
            right: 10px;
            cursor: pointer;
            color: #c2c2c2;
        }

        .layuiadmin-big-font span {
            font-weight: normal;
            font-size: 18px;
            color: orange;
        }
    </style>
</head>

<body>
    <div id="vm">
        <div class="energyMain">
            <div class="head">
                <button type="button" :class="{'active': energyShow == 1}" @click="energyShowClick(1)">企业</button>
                <button type="button" :class="{'active': energyShow == 2}" @click="energyShowClick(2)">行业</button>
                <button type="button" :class="{'active': energyShow == 3}" @click="energyShowClick(3)">行政区域</button>
            </div>
            <div class="mainContent">
                <div>
                    <div class="title" v-show="energyShow==1">
                        <span class="layui-icon layui-icon-note"></span>
                        <div class="layui-inline layui-form">
                            <div class="layui-input-inline">
                                <el-select v-model="enterprise" @change="enterSelect" placeholder="请选择">
                                    <el-option v-for="item in enterpriseOptions" :key="item.value" :label="item.name" :value="item.id">
                                    </el-option>
                                </el-select>
                            </div>
                            <div class="layui-input-inline">
                                <el-select v-model="monitorName" @change="monitorSelect" placeholder="请选择">
                                    <el-option value="" label="全部">
                                    </el-option>
                                    <el-option v-for="item in monitorNameOptions" :key="item.value" :label="item.monitorName" :value="item.id">
                                    </el-option>
                                </el-select>
                            </div>
                        </div>
                    </div>
                    <div class="title" v-show="energyShow==2">
                        <span class="layui-icon layui-icon-component"></span>
                        <div class="layui-inline layui-form">
                            <div class="layui-input-inline">
                                <!--   <select name="industry" id="industry">
                                    <option value="">请选择行业</option>
                                    <option value=""></option>
                                </select> -->
                                <el-select v-model="industry" @change="industrySelect" placeholder="请选择">
                                    <el-option v-for="item in industryOptions" :key="item.value" :label="item.name" :value="item.id">
                                    </el-option>
                                </el-select>
                            </div>

                        </div>
                    </div>
                    <div class="title" v-show="energyShow==3">
                        <span class="layui-icon layui-icon-location"></span>
                        <div class="layui-inline layui-form">
                            <div class="layui-input-inline AdminArea">
                                <input type="text" name="organizeName" v-model="atraName" placeholder="请选择行政区域" autocomplete="off" class="layui-input">
                                <i class="layui-icon layui-icon-triangle-d" @click="AdminFocus"></i>
                                <div class="Areashow layui-anim layui-anim-upbit" v-show="Areashow">
                                    <el-tree :highlight-current="treeHign" default-expand-all :expand-on-click-node="false" :data="treeData" :props="defaultProps"
                                        @node-click="handleNodeClick"></el-tree>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bottomContent">
                        <!-- 功率 -->
                        <div class="layui-row" v-show="energyShow==1">
                            <div class="layui-col-md3">
                                <div class="layui-row grid-demo">
                                    <h3>功率峰值</h3>
                                    <div class="layui-col-md12">
                                        <div class="grid-demo grid-demo-bg2">
                                            <div class="layui-card">
                                                <div class="layui-card-header">
                                                    今日
                                                    <span class="layui-badge layui-bg-green layuiadmin-badge">日</span>
                                                </div>
                                                <div class="layui-card-body layuiadmin-card-list">
                                                    <p class="layuiadmin-big-font">{{NpowerData.nowp}}
                                                        <span>kW</span>
                                                    </p>
                                                    <!-- <p> -->

                                                    <span class="layuiadmin-span-color">
                                                        <i class="layui-inline layui-icon layui-icon-date"></i>{{NpowerData.nowday}}
                                                    </span>
                                                    <!-- </p> -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="layui-col-md12">
                                        <div class="grid-demo grid-demo-bg3">
                                            <!-- <span>功率峰值</span> -->
                                            <div class="layui-col-md12">
                                                <div class="grid-demo grid-demo-bg2">
                                                    <div class="layui-card">
                                                        <div class="layui-card-header">
                                                            昨日
                                                            <span class="layui-badge layui-bg-green layuiadmin-badge">日</span>
                                                        </div>
                                                        <div class="layui-card-body layuiadmin-card-list">
                                                            <p class="layuiadmin-big-font">{{YpowerData.nowp}}
                                                                <span>kW</span>
                                                            </p>
                                                            <!-- <p> -->

                                                            <span class="layuiadmin-span-color">
                                                                <i class="layui-inline layui-icon layui-icon-date"></i>{{YpowerData.nowday}}
                                                            </span>
                                                            <!-- </p> -->
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="layui-col-md12">
                                        <h3>用电量峰值</h3>
                                        <div class="grid-demo grid-demo-bg2">
                                            <div class="layui-card">
                                                <div class="layui-card-header">
                                                    今日
                                                    <span class="layui-badge layui-bg-blue layuiadmin-badge">日</span>
                                                </div>
                                                <div class="layui-card-body layuiadmin-card-list">
                                                    <p class="layuiadmin-big-font">{{Nelectricity.nowkWh}}
                                                        <span>kW·h</span>
                                                    </p>

                                                    <!-- <p> -->

                                                    <span class="layuiadmin-span-color">
                                                        <i class="layui-inline layui-icon layui-icon-date"></i>{{Nelectricity.nowday}}:00
                                                    </span>
                                                    <!-- </p> -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="layui-col-md12">
                                        <div class="grid-demo grid-demo-bg3">
                                            <div class="layui-card">
                                                <div class="layui-card-header">
                                                    昨日
                                                    <span class="layui-badge layui-bg-blue layuiadmin-badge">日</span>
                                                </div>
                                                <div class="layui-card-body layuiadmin-card-list">
                                                    <p class="layuiadmin-big-font">{{Yelectricity.nowkWh}}
                                                        <span>kW·h</span>
                                                    </p>
                                                    <!-- <p> -->

                                                    <span class="layuiadmin-span-color">
                                                        <i class="layui-inline layui-icon layui-icon-date"></i>{{Yelectricity.nowday}}:00
                                                    </span>
                                                    <!-- </p> -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-col-md9">
                                <div class="layui-row grid-demo grid-demo-bg1">
                                    <!-- <span>功率曲线</span> -->
                                    <div style="width:100%; height: 500px;" id="energyId"></div>
                                </div>
                            </div>
                        </div>
                        <!-- 电能环比 -->

                        <div class="layui-row rowline">
                            <div class="layui-col-md5">
                                <h3>电能环比</h3>
                                <div class="layui-row grid-demo">
                                    <div class="layui-col-md4" v-for="(item,index) in EleRadius[0]" :key="'info1-'+index">
                                        <div class="grid-demo grid-demo-bg2">
                                            <div class="layui-card">
                                                <div class="layui-card-header" v-if="item.flag == 'n'">
                                                    今日用电
                                                    <span class="layui-badge layui-bg-green layuiadmin-badge">日</span>
                                                </div>
                                                <div class="layui-card-header" v-else-if="item.flag == 'y'">
                                                    昨日用电
                                                    <span class="layui-badge layui-bg-green layuiadmin-badge">日</span>
                                                </div>
                                                <div class="layui-card-header" v-else-if="item.flag == 'p'">
                                                    趋势
                                                    <span class="layui-badge layui-bg-green layuiadmin-badge">势</span>
                                                </div>
                                                <div class="layui-card-body layuiadmin-card-list" v-if="item.flag == 'n'">
                                                    <p class="layuiadmin-big-font">{{item.kwh}}
                                                        <span>KWh</span>
                                                    </p>
                                                </div>
                                                <div class="layui-card-body layuiadmin-card-list" v-else-if="item.flag == 'y'">
                                                    <p class="layuiadmin-big-font">{{item.kwh}}
                                                        <span>KWh</span>
                                                    </p>
                                                </div>
                                                <div class="layui-card-body layuiadmin-card-list" v-else>
                                                    <p>
                                                        {{item.pt}}%
                                                        <p style="width:100%;height: 1px; background-color: #000;"></p>
                                                        <span>{{item.pb}}</span>
                                                        <span>KWh</span>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- <div class="layui-col-md4">
                                        <div class="grid-demo grid-demo-bg2">
                                            <div class="layui-card">
                                                <div class="layui-card-header">
                                                    趋势
                                                    <span class="layui-badge layui-bg-green layuiadmin-badge">势</span>
                                                </div>
                                                <div class="layui-card-body layuiadmin-card-list">
                                                    <p class="layuiadmin-big-font">9
                                                        <span>kwh</span>
                                                    </p>

                                                </div>
                                            </div>
                                        </div>
                                    </div> -->


                                    <div class="layui-col-md4" v-for="(item,index) in EleRadius[1]" :key="'info2-'+index">
                                        <div class="grid-demo grid-demo-bg2">
                                            <div class="layui-card">
                                                <div class="layui-card-header" v-if="item.flag == 'n'">
                                                    当月用电
                                                    <span class="layui-badge layui-bg-green layuiadmin-badge">月</span>
                                                </div>
                                                <div class="layui-card-header" v-else-if="item.flag == 'y'">
                                                    上月用电
                                                    <span class="layui-badge layui-bg-green layuiadmin-badge">月</span>
                                                </div>
                                                <div class="layui-card-header" v-else-if="item.flag == 'p'">
                                                    上月用电
                                                    <span class="layui-badge layui-bg-green layuiadmin-badge">月</span>
                                                </div>
                                                <div class="layui-card-body layuiadmin-card-list" v-if="item.flag == 'n'">
                                                    <p class="layuiadmin-big-font">{{item.kwh}}
                                                        <span>KWh</span>
                                                    </p>


                                                </div>
                                                <div class="layui-card-body layuiadmin-card-list" v-else-if="item.flag == 'y'">
                                                    <p class="layuiadmin-big-font">{{item.kwh}}
                                                        <span>KWh</span>
                                                    </p>

                                                </div>
                                                <div class="layui-card-body layuiadmin-card-list" v-else>
                                                    <p>
                                                        {{item.pt}}%
                                                        <p style="width:100%;height: 1px; background-color: #000;"></p>
                                                        <span>{{item.pb}}</span>
                                                        <span>KWh</span>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- <div class="layui-col-md4">
                                        <div class="grid-demo grid-demo-bg2">
                                            <div class="layui-card">
                                                <div class="layui-card-header">
                                                    趋势
                                                    <span class="layui-badge layui-bg-green layuiadmin-badge">势</span>
                                                </div>
                                                <div class="layui-card-body layuiadmin-card-list">
                                                    <p class="layuiadmin-big-font">9
                                                        <span>kwh</span>
                                                    </p>

                                                </div>
                                            </div>
                                        </div>
                                    </div> -->

                                    <div class="layui-col-md4" v-for="(item,index) in EleRadius[2]" :key="'info3-'+index">
                                        <div class="grid-demo grid-demo-bg2">
                                            <div class="layui-card">
                                                <div class="layui-card-header" v-if="item.flag == 'n'">
                                                    当年用电
                                                    <span class="layui-badge layui-bg-green layuiadmin-badge">年</span>
                                                </div>
                                                <div class="layui-card-header" v-else-if="item.flag == 'y'">
                                                    上年同期
                                                    <span class="layui-badge layui-bg-green layuiadmin-badge">年</span>
                                                </div>
                                                <div class="layui-card-header" v-else-if="item.flag == 'p'">
                                                    趋势
                                                    <span class="layui-badge layui-bg-green layuiadmin-badge">势</span>
                                                </div>
                                                <div class="layui-card-body layuiadmin-card-list" v-if="item.flag == 'n'">
                                                    <p class="layuiadmin-big-font">{{item.kwh}}
                                                        <span>KWh</span>
                                                    </p>


                                                </div>
                                                <div class="layui-card-body layuiadmin-card-list" v-else-if="item.flag == 'y'">
                                                    <p class="layuiadmin-big-font">{{item.kwh}}
                                                        <span>KWh</span>
                                                    </p>

                                                </div>
                                                <div class="layui-card-body layuiadmin-card-list" v-else>
                                                    <p>
                                                        {{item.pt}}%
                                                        <p style="width:100%;height: 1px; background-color: #000;"></p>
                                                        <span>{{item.pb}}</span>
                                                        <span>KWh</span>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>



                                </div>
                            </div>
                            <div class="layui-col-md7">
                                <div class="layui-row grid-demo grid-demo-bg1">
                                    <!-- <span>电能趋势</span> -->
                                    <div class="warm-btn">
                                        <button type="button" :class="{'active': electricShow == 1}" @click="electriClick(1)" class="layui-btn layui-btn-sm layui-btn-warm">日</button>
                                        <button type="button" :class="{'active': electricShow == 2}" @click="electriClick(2)" class="layui-btn layui-btn-sm layui-btn-warm">月</button>
                                        <button type="button" :class="{'active': electricShow == 3}" @click="electriClick(3)" class="layui-btn layui-btn-sm layui-btn-warm">年</button>
                                    </div>
                                    <div class="btn-radius">
                                        <button type="button" :class="{'active': radiusShow == 1}" @click="radiusClick(1)" class="layui-btn layui-btn-sm layui-btn-warm">同比</button>
                                        <button type="button" :class="{'active': radiusShow == 2}" @click="radiusClick(2)" class="layui-btn layui-btn-sm layui-btn-warm">环比</button>
                                    </div>
                                    <div style="width:100%; height: 350px;" id="electricityId">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 用电排比 -->

                        <div class="layui-row rowline">
                            <div class="layui-col-md12">
                                <!-- <span>用电排名</span> -->
                                <div class="layui-row grid-demo">
                                    <div class="shopLine" v-show="energyShow==1">
                                        <button type="button" :class="{'active': shopShow == 1}" @click="shopClick(1)" class="layui-btn layui-btn-warm">车间</button>
                                        <button type="button" :class="{'active': shopShow == 2}" @click="shopClick(2)" class="layui-btn layui-btn-warm">回路</button>
                                    </div>
                                    <div style="width: 100%; height: 400px;" id="electricNum"></div>

                                </div>
                            </div>

                        </div>


                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="./../../../layuiadmin/layui/layui.js"></script>
    <script src="./../../../layuiadmin/plugin/vue.js"></script>
    <script src="./../../../layuiadmin/plugin/element.js"></script>
    <script src="./../../../layuiadmin/plugin/echarts.min.js"></script>
    <script src="./../../../layuiadmin/plugin/axios.js"></script>

    <script src="./../../../layuiadmin/js/baseUrlConfig.js"></script>
    <script>
        layui.config({
            base: '../../../layuiadmin/' //静态资源所在路径
        }).extend({
            index: 'lib/index' //主入口模块
        }).use(['index', 'form', 'table', 'jquery', 'laydate', 'echarts'], function () {
            var form = layui.form,
                table = layui.table,
                $ = layui.jquery,
                echarts = layui.echarts,
                laydate = layui.laydate;

            // 功率曲线

            // 电能趋势


            // 用电排名
            var electricNum = echarts.init($("#electricNum")[0]);
            var labelRight = {
                normal: {
                    position: 'right'
                }
            };
            var option = {
                title: {
                    left: 'center',
                    text: '用电排名',
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                        type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                    }
                },
                grid: {
                    top: 80,
                    bottom: 30
                },
                xAxis: {
                    type: 'value',
                    position: 'top',
                    splitLine: { lineStyle: { type: 'dashed' } },
                },
                yAxis: {
                    type: 'category',
                    axisLine: { show: false },
                    axisLabel: { show: true },
                    axisTick: { show: false },
                    splitLine: { show: false },
                    data: ['ten', 'nine', 'eight', 'seven']
                },
                series: [
                    {
                        name: '生活费',
                        type: 'bar',
                        stack: '总量',
                        label: {
                            normal: {
                                show: true,
                                formatter: '{b}'
                            }
                        },
                        barWidth: 40,
                        data: [
                            {
                                value: 0.2
                            }, {
                                value: 0.5
                            }, {
                                value: 8
                            }, {
                                value: 6.2
                            },
                        ]
                    }
                ]
            };
            electricNum.setOption(option);

        });


        var vm = new Vue({
            el: "#vm",
            data: {
                energyShow: 1,
                electricShow: 1,
                radiusShow: 1,
                shopShow: 1,
                Areashow: false,
                atraName: "",
                treeHign: false,
                treeData: [],
                defaultProps: {
                    children: 'children',
                    label: 'title'
                },
                // 用电量峰值数据
                Yelectricity: {
                    nowkWh: '0',
                    nowday: "00",
                },
                Nelectricity: {
                    nowkWh: '0',
                    nowday: "00",
                },
                // 选择框填充
                enterprise: "",
                enterpriseOptions: [],
                monitorName: "",
                monitorNameOptions: [],
                industry: "",
                industryOptions: [],
                // 用电量数据请求参数
                enterpriseId: "",
                monitorId: "",
                // 功率峰值
                YpowerData: {
                    nowday: "00:00",
                    nowp: 0
                },
                NpowerData: {
                    nowday: "00:00",
                    nowp: 0
                },
                // 用电量环比
                EleRadius: [],
                industryId: "",
                atraId: ""


            },
            methods: {
                AdminFocus() {
                    vm.Areashow = !vm.Areashow;
                },
                // 行政区域列表数据的获取
                treeDataInit() {
                    axios({
                        method: "post",
                        url: BASEURL + 'environmental_intelligent_monitoring/tbasorganize/dendrogramList',
                        params: {
                            type: "2"
                        }
                    }).then(function (res) {
                        if (res.data.code == 0) {

                            // vm.treeData = [];
                            // vm.treeData = res.data.page.list;
                            var data = res.data.data;
                            vm.treeData = data;
                        } else {

                        }
                    }).catch(function (err) {
                        console.log(err);
                    });

                },
                handleNodeClick(data, node) {
                    console.log(data, node)
                    vm.atraName = data.title;
                    vm.atraId = data.id;
                    vm.treeHign = true;
                    vm.Areashow = false;
                    this.electricyRadius(-1, -1, -1, vm.atraId);
                    if (this.electricShow == 1) {
                        // 电能趋势按日统计
                        this.electricityDay(-1, -1, -1, vm.atraId);

                    } else if (this.electricShow == 2) {
                        // 电能趋势按月统计
                        this.electricityMonth(-1, -1, -1, vm.atraId);

                    } else {
                        this.electricityYear(-1, -1, -1, vm.atraId)
                    }


                },
                // 大页面的按钮切换
                energyShowClick(val) {
                    if (val == 1) {
                        this.energyShow = 1;
                        if (this.electricShow == 1) {
                            // 电能趋势按日统计
                            this.electricityDay(-1, 0);

                        } else if (this.electricShow == 2) {
                            // 电能趋势按月统计
                            this.electricityMonth(-1, 0);

                        } else {
                            this.electricityYear(-1,0);
                        }


                    } else if (val == 2) {
                        this.energyShow = 2;
                        if (this.electricShow == 1) {
                            // 电能趋势按日统计
                            this.electricityDay(0, 0, 0);

                        } else if (this.electricShow == 2) {
                            // 电能趋势按月统计
                            this.electricityMonth(0, 0, 0);
                        } else {
                            this.electricityYear(0,0,0)
                        }


                    } else if (val == 3) {
                        this.energyShow = 3;
                        if (this.electricShow == 1) {
                            // 电能趋势按日统计
                            this.electricityDay(-1, -1, -1, 0);

                        } else if (this.electricShow == 2) {
                            // 电能趋势按月统计
                            this.electricityMonth(-1, -1, -1, 0);
                        } else {
                            this.electricityYear(-1,-1,-1,0)
                        }


                    }
                },
                electriClick(value) {
                    console.log(value);
                    if (value == 1) {
                        this.electricShow = 1;
                        // 电能趋势按日统计
                        this.electricityDay(vm.enterpriseId, vm.monitorId);
                    } else if (value == 2) {
                        this.electricShow = 2;
                        // 电能趋势按月统计
                        this.electricityMonth(vm.enterpriseId, vm.monitorId)
                    } else if (value == 3) {
                        this.electricShow = 3;
                        this.electricityYear(vm.enterpriseId, vm.monitorId)
                    }

                },
                radiusClick(value) {
                    if (value == 1) {
                        this.radiusShow = 1;
                    } else {
                        this.radiusShow = 2;
                    }

                    if (this.energyShow == 1) {
                        if (this.electricShow == 1) {
                            // 电能趋势按日统计
                            this.electricityDay(vm.enterpriseId, vm.monitorId);

                        } else if (this.electricShow == 2) {
                            this.electricityMonth(vm.enterpriseId, vm.monitorId);
                        } else {
                            this.electricityYear(vm.enterpriseId, vm.monitorId)
                        }




                    } else if (this.energyShow == 2) {
                        if (this.electricShow == 1) {
                            // 电能趋势按日统计
                            this.electricityDay(0, 0, vm.industryId);

                        } else if (this.electricShow == 2) {
                            this.electricityMonth(0, 0, vm.industryId);
                        } else{
                            this.electricityYear(0, 0, vm.industryId)
                        }




                    } else {
                        if (this.electricShow == 1) {
                            // 电能趋势按日统计
                            this.electricityDay(-1, -1, -1, vm.atraId);

                        } else if (this.electricShow == 2) {
                            this.electricityMonth(-1, -1, -1, vm.atraId);
                        }else {
                            this.electricityYear(-1, -1, -1, vm.atraId)
                        }



                    }


                },
                shopClick(value) {
                    if (value == 1) {
                        this.shopShow = 1;
                    } else {
                        this.shopShow = 2;
                    }

                },
                // 企业列表填充
                enterpriseInit() {
                    axios({
                        method: "post",
                        url: BASEURL + 'environmental_intelligent_monitoring/tbasenterprise/list?limit=10000',
                        params: {}
                    }).then(function (res) {
                        if (res.data.code == 0) {
                            // console.log(res)
                            vm.enterpriseOptions = res.data.page.list;

                        } else {

                        }
                    }).catch(function (err) {
                        console.log(err);
                    });

                }
                , enterSelect(val) {
                    console.log(val)
                    vm.enterpriseId = val;
                    this.electricityTop(vm.enterpriseId, vm.monitorId)
                    this.powerInit(vm.enterpriseId, vm.monitorId)
                    this.powerEcharts(vm.enterpriseId, vm.monitorId)
                    this.electricyRadius(vm.enterpriseId, vm.monitorId)
                    if (this.electricShow == 1) {
                        // 电能趋势按日统计
                        this.electricityDay(vm.enterpriseId, vm.monitorId);
                    } else if (this.electricShow == 2) {
                        // 电能趋势按月统计
                        this.electricityMonth(vm.enterpriseId, vm.monitorId);

                    } else {
                        this.electricityYear(vm.enterpriseId, vm.monitorId)
                    }


                }
                // 监测点列表展示
                , monitorNameInit() {
                    axios({
                        method: "post",
                        url: BASEURL + 'environmental_intelligent_monitoring/tdevicemonitor/list?limit=10000',
                        params: {}
                    }).then(function (res) {
                        if (res.data.code == 0) {
                            vm.monitorNameOptions = res.data.page.list

                        } else {

                        }
                    }).catch(function (err) {
                        console.log(err);
                    });
                }
                , monitorSelect(val) {
                    console.log(val);
                    vm.monitorId = val;
                    this.electricityTop(vm.enterpriseId, vm.monitorId)
                    this.powerInit(vm.enterpriseId, vm.monitorId)
                    this.powerEcharts(vm.enterpriseId, vm.monitorId)
                    this.electricyRadius(vm.enterpriseId, vm.monitorId)
                    if (this.electricShow == 1) {
                        // 电能趋势按日统计
                        this.electricityDay(vm.enterpriseId, vm.monitorId);
                    } else if (this.electricShow == 2) {
                        // 电能趋势按月统计
                        this.electricityMonth(vm.enterpriseId, vm.monitorId);

                    } else {
                        this.electricityYear(vm.enterpriseId, vm.monitorId)
                    }
                }
                // 用电量峰值展示
                , electricityTop(enterpriseId, monitorId) {
                    // console.log(enterpriseId, monitorId)
                    axios({
                        method: "post",
                        url: BASEURL + 'environmental_intelligent_monitoring/tkwhhour/queryElePeak',
                        params: {
                            // enterpriseId:89
                            enterpriseId: enterpriseId,
                            monitorId: monitorId
                        }
                    }).then(function (res) {
                        if (res.data.code == 0) {
                            var data = res.data.data;
                            if (data.length != 0) {
                                data.forEach(function (data) {
                                    console.log(data);
                                    if (data.flag == "y") {
                                        vm.Yelectricity = data;
                                    } else {
                                        vm.Nelectricity = data;
                                    }

                                })
                            } else {
                                vm.Yelectricity = {
                                    nowkWh: "0",
                                    nowday: "00",
                                };
                                vm.Nelectricity = {
                                    nowkWh: "0",
                                    nowday: "00",
                                };
                            }
                            console.log(vm.electricity)

                        } else {

                        }
                    }).catch(function (err) {
                        console.log(err);
                    });
                }
                // 功率峰值展示
                , powerInit(enterpriseId, monitorId) {
                    axios({
                        method: "post",
                        url: BASEURL + 'environmental_intelligent_monitoring/tdevicehistory/queryPowerPeak',
                        params: {
                            // enterpriseId:89
                            enterpriseId: enterpriseId,
                            monitorId: monitorId
                        }
                    }).then(function (res) {
                        if (res.data.code == 0) {
                            var data = res.data.data;
                            if (data.length != 0) {
                                data.forEach(function (data) {
                                    console.log(data);
                                    if (data.flag == "y") {
                                        vm.YpowerData = data;
                                    } else {
                                        vm.NpowerData = data;
                                    }

                                })

                            } else {
                                vm.YpowerData = {
                                    nowday: "00:00",
                                    nowp: 0
                                };
                                vm.NpowerData = {
                                    nowday: "00:00",
                                    nowp: 0
                                };
                            }
                            console.log(vm.powerData)

                        } else {

                        }
                    }).catch(function (err) {
                        console.log(err);
                    });

                }
                // 功率曲线展示
                , powerEcharts(enterpriseId, monitorId) {
                    var myCharts = echarts.init(document.getElementById('energyId'));
                    myCharts.showLoading({
                        text: "加载中"
                    });


                    axios({
                        method: "post",
                        url: BASEURL + 'environmental_intelligent_monitoring/tdevicehistory/queryPowerCurve',
                        params: {
                            // enterpriseId:89
                            enterpriseId: enterpriseId,
                            monitorId: monitorId
                        }
                    }).then(function (res) {
                        if (res.data.code == 0) {
                            var powerData = res.data.data;

                            var todayData = [],
                                todayTime = [],
                                yestodayData = [],
                                yestodayTime = []
                            for (var i = 0; i < powerData.yslist.length; i++) {
                                console.log(powerData.yslist[i]);
                                yestodayData.push(
                                    powerData.yslist[i].ysp
                                )
                                yestodayTime.push(
                                    powerData.yslist[i].ysday,
                                )
                            }
                            for (var i = 0; i < powerData.nowlist.length; i++) {
                                console.log(powerData.nowlist[i]);
                                todayData.push(
                                    powerData.nowlist[i].nowp
                                )
                                todayTime.push(
                                    powerData.nowlist[i].nowday,
                                )
                            }
                            /*  console.log(yestodayData)
                             console.log(yestodayTime) */
                            var option = {
                                noDataLoadingOption: {
                                    text: '暂无数据',//没有数据时显示的文字
                                    effect: 'bubble',//loading效果，此为气泡，还有'spin' | 'bar' | 'ring' | 'whirling' | 'dynamicLine' | 'bubble'
                                    effectOption: {
                                        backgroundColor: "rgba(50,50,50,0)",//loading的背景
                                    },
                                    textStyle: {//没有数据时显示的文字的样式
                                        fontSize: 32,
                                        fontWeight: 'bold'
                                    }
                                },
                                title: {
                                    text: '功率曲线'
                                },
                                tooltip: {
                                    trigger: 'axis',
                                    formatter: '{b0}<br />{a0}:{c0}<br />{a1}:{c1}',
                                },
                                legend: {
                                    data: ['今日', '昨日']
                                },
                                grid: {
                                    left: '3%',
                                    right: '4%',
                                    bottom: '3%',
                                    containLabel: true
                                },
                                toolbox: {
                                    feature: {
                                        saveAsImage: {}
                                    }
                                },
                                xAxis: {
                                    type: 'category',
                                    boundaryGap: false,
                                    data: todayTime
                                },
                                yAxis: {
                                    type: 'value',
                                    name: '单位(kW)',
                                },
                                series: [
                                    {
                                        name: '昨日',
                                        type: 'line',
                                        stack: '总量',
                                        data: yestodayData
                                    }, {
                                        name: '今日',
                                        type: 'line',
                                        stack: '总量',
                                        data: todayData
                                    }
                                ]
                            };
                            myCharts.hideLoading();
                            // myCharts.resize();
                            myCharts.setOption(option);


                        } else {

                        }
                    }).catch(function (err) {
                        console.log(err);
                    });
                }
                // 电能环比展示
                , electricyRadius(enterpriseId, monitorId, industryId, atraId) {
                    var data = {};
                    if (enterpriseId == 0 && monitorId == 0) {
                        data.tradeId = industryId;
                    } else if (enterpriseId == -1 && monitorId == -1 && industryId == -1) {
                        data.organizeId = atraId;
                    } else {
                        data.enterpriseId = enterpriseId;
                        data.monitorId = monitorId;
                    }
                    vm.EleRadius = [];
                    axios({
                        method: "post",
                        url: BASEURL + 'environmental_intelligent_monitoring/tkwhdaily/queryEleRatio',
                        // params: {
                        //     // enterpriseId:89
                        //     enterpriseId: enterpriseId,
                        //     monitorId: monitorId,
                        //     tradeId: industryId
                        //     // organizeId:1
                        // }
                        params: data
                    }).then(function (res) {
                        if (res.data.code == 0) {
                            var data = res.data.data;
                            var daily = [];
                            var month = [];
                            var year = [];
                            for (var i = 0; i < data.daily.length; i++) {
                                var today, yestoday, powerbot, powertop;

                                if (data.daily[i].flag == 'n') {
                                    today = data.daily[i].kwh === undefined ? 0 : data.daily[i].kwh;
                                } else {
                                    yestoday = data.daily[i].kwh === undefined ? 0 : data.daily[i].kwh;
                                }
                                powerbot = today - yestoday < 0 ? '-' + (today - yestoday) : '+' + (today - yestoday);
                                powertop = isNaN(powerbot / today) === true ? 0 : (powerbot / today).toFixed(2);
                                console.log(powerbot, powertop, today, yestoday)

                            }
                            daily.push({
                                flag: 'n',
                                kwh: today
                            }, {
                                    flag: 'y',
                                    kwh: yestoday,

                                }, {
                                    flag: 'p',
                                    pt: powertop,
                                    pb: powerbot
                                })

                            for (var i = 0; i < data.month.length; i++) {
                                var today, yestoday, powerbot, powertop;

                                if (data.month[i].flag == 'n') {
                                    today = data.month[i].kwh === undefined ? 0 : data.month[i].kwh;
                                } else {
                                    yestoday = data.month[i].kwh === undefined ? 0 : data.month[i].kwh;
                                }
                                powerbot = today - yestoday < 0 ? '-' + (today - yestoday) : '+' + (today - yestoday);
                                powertop = isNaN(powerbot / today) === true ? 0 : (powerbot / today).toFixed(2);
                                if (powertop === NaN) {
                                    powertop = 0;
                                }

                            }
                            // console.log(vm.EleRadius.daily)

                            month.push({
                                flag: 'n',
                                kwh: today
                            }, {
                                    flag: 'y',
                                    kwh: yestoday,

                                }, {
                                    flag: 'p',
                                    pt: powertop,
                                    pb: powerbot
                                })
                            for (var i = 0; i < data.year.length; i++) {
                                var today, yestoday, powerbot, powertop;

                                if (data.year[i].flag == 'n') {
                                    today = data.year[i].kwh === undefined ? 0 : data.year[i].kwh;
                                } else {
                                    yestoday = data.year[i].kwh === undefined ? 0 : data.year[i].kwh;
                                }
                                powerbot = today - yestoday < 0 ? '-' + (today - yestoday) : '+' + (today - yestoday);
                                powertop = isNaN(powerbot / today) === true ? 0 : (powerbot / today).toFixed(2);
                                if (powertop === NaN) {
                                    powertop = 0;
                                }

                            }
                            year.push({
                                flag: 'n',
                                kwh: today
                            }, {
                                    flag: 'y',
                                    kwh: yestoday,

                                }, {
                                    flag: 'p',
                                    pt: powertop,
                                    pb: powerbot
                                })
                            vm.EleRadius.push(daily, month, year)
                            console.log(vm.EleRadius)


                        } else {

                        }
                    }).catch(function (err) {
                        console.log(err);
                    });

                }
                // 电能趋势按日统计
                , electricityDay(enterpriseId, monitorId, industryId, atraId) {
                    var type;
                    if (this.radiusShow == 1) {
                        type = 'same';
                    } else {
                        type = 'ring';
                    }

                    var data = {};
                    if (enterpriseId == 0 && monitorId == 0) {
                        data.tradeId = industryId;
                        data.ratioType = type;
                    } else if (enterpriseId == -1 && monitorId == -1 && industryId == -1) {
                        data.organizeId = atraId;
                        data.ratioType = type;
                    } else {
                        data.enterpriseId = enterpriseId;
                        data.monitorId = monitorId;
                        data.ratioType = type;
                    }
                    axios({
                        method: "post",
                        url: BASEURL + 'environmental_intelligent_monitoring/tkwhhour/queryEleTrendByDaily',
                        /* params: {
                            enterpriseId: enterpriseId,
                            monitorId: monitorId,
                            tradeId: industryId,
                            ratioType: type
                        } */
                        params: data
                    }).then(function (res) {
                        if (res.data.code == 0) {
                            var nowdata = res.data.now;
                            var ysNowdata = res.data.ys;
                            var timeData = [];
                            var nowData = [];
                            var yesTodayData = [];
                            for (var i = 0; i < 24; i++) {
                                if (i < 10) {
                                    i = '0' + i
                                }
                                timeData.push(i);
                            }

                            let c = [];
                            let yes = [];
                            timeData.forEach(t1 => {
                                let exist = nowdata.some(t2 => t1 == t2.hour);
                                let Ysexist = ysNowdata.some(t2 => t1 == t2.hour);
                                console.log(exist);
                                if (!exist) {
                                    c.push({
                                        hour: t1,
                                        kwh: 0
                                    });
                                }
                                if (!Ysexist) {
                                    yes.push({
                                        hour: t1,
                                        kwh: 0
                                    });
                                }
                            });
                            nowdata.forEach(function (item) {
                                console.log(item)
                                c.push(item)
                            })
                            ysNowdata.forEach(function (item) {
                                console.log(item)
                                yes.push(item)
                            })
                            // console.log(c)
                            function compare(property) {
                                return function (a, b) {
                                    var value1 = a[property];
                                    var value2 = b[property];
                                    return value1 - value2;
                                }
                            }
                            var nowdata = c.sort(compare('hour'));
                            var yesdata = yes.sort(compare('hour'));
                            for (var i = 0; i < nowdata.length; i++) {
                                nowData.push(nowdata[i].kwh);
                            }
                            for (var i = 0; i < yesdata.length; i++) {
                                yesTodayData.push(yesdata[i].kwh);
                            }
                            // console.log(yesTodayData)
                            // console.log(nowdata)

                            var electricity = echarts.init(document.getElementById("electricityId"));
                            var option = {
                                title: {
                                    left: 'left',
                                    text: '电能趋势',
                                },
                                tooltip: {
                                    trigger: 'axis',
                                    axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                                        type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                                    }
                                },
                                legend: {
                                    data: ['今日', '昨日'],
                                    x: '16%',

                                },
                                xAxis: {
                                    type: 'category',
                                    data: timeData
                                },
                                yAxis: {
                                    type: 'value',
                                    name: '单位(kW.h)',
                                },
                                series: [{
                                    name: '今日',
                                    data: nowData,
                                    barWidth: 10,
                                    type: 'bar'
                                }, {
                                    name: '昨日',
                                    data: yesTodayData,
                                    barWidth: 10,
                                    type: 'bar'
                                }]
                            };
                            electricity.setOption(option);

                        } else {

                        }
                    }).catch(function (err) {
                        console.log(err);
                    });

                }
                // 电能趋势按月统计
                , electricityMonth(enterpriseId, monitorId, industryId, atraId) {
                    var type;
                    if (this.radiusShow == 1) {
                        type = 'same';
                    } else {
                        type = 'ring';
                    }
                    var data = {};
                    if (enterpriseId == 0 && monitorId == 0) {
                        data.tradeId = industryId;
                        data.ratioType = type;
                    } else if (enterpriseId == -1 && monitorId == -1 && industryId == -1) {
                        data.organizeId = atraId;
                        data.ratioType = type;
                    } else {
                        data.enterpriseId = enterpriseId;
                        data.monitorId = monitorId;
                        data.ratioType = type;
                    }
                    axios({
                        method: "post",
                        url: BASEURL + 'environmental_intelligent_monitoring/tkwhdaily/queryEleTrendByMonth',
                        /*  params: {
                             enterpriseId: enterpriseId,
                             monitorId: monitorId,
                             // tradeId: industryId,
                             ratioType: type
                         } */
                        params: data
                    }).then(function (res) {
                        if (res.data.code == 0) {
                            var nowdata = res.data.now;
                            var ysNowdata = res.data.ys;
                            var timeData = [];
                            var nowData = [];
                            var yesTodayData = [];
                            for (var i = 1; i < 32; i++) {
                                if (i < 10) {
                                    i = '0' + i
                                }
                                timeData.push(i);
                            }

                            let c = [];
                            let yes = [];
                            timeData.forEach(t1 => {
                                let exist = nowdata.some(t2 => t1 == t2.day);
                                let Ysexist = ysNowdata.some(t2 => t1 == t2.day);
                                console.log(exist);
                                if (!exist) {
                                    c.push({
                                        day: t1,
                                        kwh: 0
                                    });
                                }
                                if (!Ysexist) {
                                    yes.push({
                                        day: t1,
                                        kwh: 0
                                    });
                                }
                            });
                            nowdata.forEach(function (item) {
                                console.log(item)
                                c.push(item)
                            })
                            ysNowdata.forEach(function (item) {
                                console.log(item)
                                yes.push(item)
                            })
                            // console.log(c)
                            function compare(property) {
                                return function (a, b) {
                                    var value1 = a[property];
                                    var value2 = b[property];
                                    return value1 - value2;
                                }
                            }
                            var nowdata = c.sort(compare('day'));
                            var yesdata = yes.sort(compare('day'));
                            for (var i = 0; i < nowdata.length; i++) {
                                nowData.push(nowdata[i].kwh);
                            }
                            for (var i = 0; i < yesdata.length; i++) {
                                yesTodayData.push(yesdata[i].kwh);
                            }
                            // console.log(yesTodayData)
                            // console.log(nowdata)

                            var electricity = echarts.init(document.getElementById("electricityId"));
                            var option = {
                                title: {
                                    left: 'left',
                                    text: '电能趋势',
                                },
                                tooltip: {
                                    trigger: 'axis',
                                    axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                                        type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                                    }
                                },
                                legend: {
                                    data: ['当月', '上月'],
                                    x: '16%',

                                },
                                xAxis: {
                                    type: 'category',
                                    data: timeData
                                },
                                yAxis: {
                                    type: 'value',
                                    name: '单位(kW.h)',
                                },
                                series: [{
                                    name: '当月',
                                    data: nowData,
                                    barWidth: 10,
                                    type: 'bar'
                                }, {
                                    name: '上月',
                                    data: yesTodayData,
                                    barWidth: 10,
                                    type: 'bar'
                                }]
                            };
                            electricity.setOption(option);

                        } else {

                        }
                    })
                        .catch(function (err) {
                            console.log(err);
                        });

                }
                // 电能趋势按年统计
                , electricityYear(enterpriseId, monitorId, industryId, atraId) {
                    var type;
                    if (this.radiusShow == 1) {
                        type = 'same';
                    } else {
                        type = 'ring';
                    }
                    var data = {};
                    if (enterpriseId == 0 && monitorId == 0) {
                        data.tradeId = industryId;
                        data.ratioType = type;
                    } else if (enterpriseId == -1 && monitorId == -1 && industryId == -1) {
                        data.organizeId = atraId;
                        data.ratioType = type;
                    } else {
                        data.enterpriseId = enterpriseId;
                        data.monitorId = monitorId;
                        data.ratioType = type;
                    }
                    axios({
                        method: "post",
                        url: BASEURL + 'environmental_intelligent_monitoring/tkwhmonthly/queryEleTrendByYear',
                        /*  params: {
                             enterpriseId: enterpriseId,
                             monitorId: monitorId,
                             // tradeId: industryId,
                             ratioType: type
                         } */
                        params: data
                    }).then(function (res) {
                        if (res.data.code == 0) {
                            var nowdata = res.data.now;
                            var ysNowdata = res.data.ys;
                            var timeData = [];
                            var nowData = [];
                            var yesTodayData = [];
                            for (var i = 1; i < 13; i++) {
                                if (i < 10) {
                                    i = '0' + i
                                }
                                timeData.push(i);
                            }

                            let c = [];
                            let yes = [];
                            timeData.forEach(t1 => {
                                let exist = nowdata.some(t2 => t1 == t2.month);
                                let Ysexist = ysNowdata.some(t2 => t1 == t2.month);
                                console.log(exist);
                                if (!exist) {
                                    c.push({
                                        month: t1,
                                        kwh: 0
                                    });
                                }
                                if (!Ysexist) {
                                    yes.push({
                                        month: t1,
                                        kwh: 0
                                    });
                                }
                            });
                            nowdata.forEach(function (item) {
                                console.log(item)
                                c.push(item)
                            })
                            ysNowdata.forEach(function (item) {
                                console.log(item)
                                yes.push(item)
                            })
                            // console.log(c)
                            function compare(property) {
                                return function (a, b) {
                                    var value1 = a[property];
                                    var value2 = b[property];
                                    return value1 - value2;
                                }
                            }
                            var nowdata = c.sort(compare('month'));
                            var yesdata = yes.sort(compare('month'));
                            for (var i = 0; i < nowdata.length; i++) {
                                nowData.push(nowdata[i].kwh);
                            }
                            for (var i = 0; i < yesdata.length; i++) {
                                yesTodayData.push(yesdata[i].kwh);
                            }
                            // console.log(yesTodayData)
                            // console.log(nowdata)

                            var electricity = echarts.init(document.getElementById("electricityId"));
                            var option = {
                                title: {
                                    left: 'left',
                                    text: '电能趋势',
                                },
                                tooltip: {
                                    trigger: 'axis',
                                    axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                                        type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                                    }
                                },
                                legend: {
                                    data: ['当年', '上年'],
                                    x: '16%',

                                },
                                xAxis: {
                                    type: 'category',
                                    data: timeData
                                },
                                yAxis: {
                                    type: 'value',
                                    name: '单位(kW.h)',
                                },
                                series: [{
                                    name: '当年',
                                    data: nowData,
                                    barWidth: 40,
                                    type: 'bar'
                                }, {
                                    name: '上年',
                                    data: yesTodayData,
                                    barWidth: 40,
                                    type: 'bar'
                                }]
                            };
                            electricity.setOption(option);

                        } else {

                        }
                    })
                        .catch(function (err) {
                            console.log(err);
                        });
                }
                // 行业列表选择框填充
                , industryInit() {
                    axios({
                        method: "post",
                        url: BASEURL + 'environmental_intelligent_monitoring/tbastrade/list?limit=10000',
                        params: {}
                    }).then(function (res) {
                        if (res.data.code == 0) {
                            // console.log(res)
                            vm.industryOptions = res.data.page.list;

                        } else {

                        }
                    }).catch(function (err) {
                        console.log(err);
                    });
                },
                industrySelect(val) {
                    vm.industryId = val;
                    this.electricyRadius(0, 0, vm.industryId);
                    if (this.electricShow == 1) {
                        // 电能趋势按日统计
                        this.electricityDay(0, 0, vm.industryId);

                    } else if (this.electricShow == 2) {
                        this.electricityMonth(0, 0, vm.industryId);

                    } else {
                        this.electricityYear(0, 0, vm.industryId)
                    }



                }
            },
            mounted() {
                this.powerEcharts(-1, 0);
                // 电能趋势按日统计
                this.electricityDay(-1, 0);
            }
            , created() {
                this.treeDataInit();
                this.enterpriseInit();
                this.monitorNameInit();
                this.industryInit();

            }
        })
    </script>
</body>

</html>