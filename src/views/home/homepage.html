<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>首页</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<link rel="stylesheet" href="../../layuiadmin/layui/css/layui.css" media="all">
		<link rel="stylesheet" type="text/css" href="../../layuiadmin/plugin/element.css" />
		<link rel="stylesheet" href="../../layuiadmin/style/admin.css" media="all">
		<link rel="stylesheet" type="text/css" href="../../layuiadmin/style/common.css" />
		<link rel="stylesheet" type="text/css" href="../../layuiadmin/style/home.css" />

	</head>

	<body>
		<div id="vm">
			<div class="message-box">
				<p>系统公告:</p>
				<p>暂无通知公告</p>
			</div>

			<div class="layui-container content">
				<div class="layui-row layui-col-space10">
					<div class="left layui-col-sm4 layui-col-xs12">
						<el-card class="box-card">
							<div slot="header">
								<span>概况</span>
							</div>
							<div class=" ">
								<div class="layui-row left-row">
									<p class="layui-col-sm6">企业数量:</p>
									<p class="layui-col-sm-6">
										<span v-text="enterpriseNum"></span> 家
									</p>
								</div>
								<div class="layui-row left-row">
									<p class="layui-col-sm6">产污监测点:</p>
									<span>
										<span v-text="productMonitorNum"></span> 个</span>
								</div>
								<div class="layui-row left-row">
									<p class="layui-col-sm6">治污监测点:</p>
									<span>
										<span v-text="treatMonitorNum"></span> 个</span>
								</div>
								<div class="layui-row left-row">
									<p class="layui-col-sm6">监测点数量:</p>
									<span>
										<span v-text="monitorNum"></span> 个</span>
								</div>
							</div>
						</el-card>
					</div>
					<div class="center layui-col-sm4 layui-col-xs6">
						<el-card class="box-card" style="height: 256px;">
							<div slot="header">
								<span>治污设施情况</span>
							</div>
							<div class="layui-row layui-col-space10">
								<div class="layui-col-sm12 layui-col-xs12">
									<span v-text=""></span>
									<span> 家企业已申报异常</span>
								</div>
							</div>
							<div class="layui-col-sm12 layui-col-xs12 ceter-row" style="margin-top: 20px;">
								<p class="layui-col-sm7 layui-col-xs7">异常企业:</p>
								<p class="layui-col-sm5 layui-col-xs5">
									<span v-text="abnormalNum"></span> 家</p>
							</div>
							<div class="layui-col-sm12 layui-col-xs12 ceter-row">
								<p class="layui-col-sm7 layui-col-xs7">涉及污染设施:</p>
								<p class="layui-col-sm5 layui-col-xs5">
									<span v-text="treatAbnormalNum"></span> 处</p>
							</div>
						</el-card>
					</div>
					<div class="right layui-col-sm4 layui-col-xs6">
						<el-card class="box-card" style="height: 256px;">
							<div slot="header">
								<span>限产/停产执行情况</span>
							</div>
							<div class="layui-col-sm12 layui-col-xs12 ceter-row">
								<p class="layui-col-sm7 layui-col-xs7">限产企业:</p>
								<p class="layui-col-sm5 layui-col-xs5">
									<span v-text="limitProduct"></span> 家</p>
							</div>
							<div class="layui-col-sm12 layui-col-xs12 ceter-row">
								<p class="layui-col-sm7 layui-col-xs7">停产企业:</p>
								<p class="layui-col-sm5 layui-col-xs5">
									<span v-text="stopProduct"></span> 家</p>
							</div>
							<div class="layui-col-sm12 layui-col-xs12 ceter-row">
								<p class="layui-col-sm7 layui-col-xs7">未执行企业:</p>
								<p class="layui-col-sm5 layui-col-xs5">
									<span v-text="unexecut"></span> 家</p>
							</div>
						</el-card>
					</div>
				</div>
				<div class="layui-row layui-col-space10" style="margin-top: 10px;">
					<div class="layui-col-sm6 layui-col-xs12">
						<el-card class="box-card" style="height: 400px;">
							<div slot="header" class="clearfix">
								<span>停限产列表</span>
							</div>
							<table id="demo" lay-filter="test"></table>
						</el-card>
					</div>
					<div class="layui-col-sm6 layui-col-xs12">
						<el-card class="box-card" style="height: 400px;">
							<div slot="header" class="clearfix">
								<span>AQI/错峰生产对比</span>
							</div>
							<div class="chart">
								<div id="zchart" style="width: 100%;height: 200px;"></div>
							</div>
						</el-card>
					</div>
				</div>

				<div class="layui-row layui-col-space10" style="margin-top: 10px;">
					<div class="layui-col-sm6 layui-col-xs12">
						<el-card class="box-card" style="height: 400px;">
							<div slot="header" class="clearfix">
								<span>各行业异常企业占比</span>
							</div>
							<div class="chart">
								<div id="tradeAbnormal" style="width: 100%;height: 330px;"></div>
							</div>
						</el-card>
					</div>
					<div class="layui-col-sm6 layui-col-xs12">
						<el-card class="box-card" style="height: 400px;">
							<div slot="header" class="clearfix">
								<span>各区域异常企业占比</span>
							</div>
							<div class="chart">
								<div id="organizeAbnormal" style="width: 100%;height: 330px;"></div>
							</div>
						</el-card>
					</div>
				</div>
				<div class="layui-row layui-col-space10" style="margin-top: 10px;">
					<div class="layui-col-sm6 layui-col-xs12">
						<el-card class="box-card" style="height: 400px;">
							<div slot="header" class="clearfix">
								<span>产/治污设施运行情况</span>
							</div>
							<div class="chart">
								<div id="startMonitor" style="width: 100%;height: 330px;"></div>
							</div>
						</el-card>
					</div>
					<!-- <div class="layui-col-sm6 layui-col-xs12">
						<el-card class="box-card" style="height: 400px;">
							<div slot="header" class="clearfix">
								<span>各区域异常企业占比</span>
							</div>
							<div class="chart">
								<div id="organizeAbnormal" style="width: 100%;height: 330px;"></div>
							</div>
						</el-card>
					</div> -->
				</div>
			</div>
		</div>


		<script src="../../layuiadmin/layui/layui.js"></script>
		<script src="../../layuiadmin/js/baseUrlConfig.js"></script>
		<script src="../../layuiadmin/plugin/vue.js"></script>
		<script src="../../layuiadmin/plugin/element.js"></script>
		<script src="../../layuiadmin/plugin/axios.js"></script>
		<script>
			var vm = new Vue({
				el: "#vm",
				data: {
					declareAbnormalNum: '',
					abnormalNum: "",
					treatAbnormalNum: '',

					limitProduct: '',
					stopProduct: '',
					unexecut: '',

					monitorNum: '',
					enterpriseNum: '',
					productMonitorNum: '',
					treatMonitorNum: '',

					abnormalTradeNum: {},
					abnormalOrganizeNum: {},
					startMonitorNum: {},

					reduceList: [],
				},
				methods: {
					pageInit: function() {
						axios({
								method: "POST",
								url: BASEURL + "/environmental_intelligent_monitoring/homePage/queryEnterpriseReport",
								params: {
									userId: window.localStorage.getItem("userId")
								}
							})
							.then(function(res) {
								console.log(res);
								if (res.data.code == 0) {
									vm.declareAbnormalNum = res.data.abnormalNum[0].declareAbnormalNum
									vm.abnormalNum = res.data.abnormalNum[0].abnormalNum
									vm.treatAbnormalNum = res.data.abnormalNum[0].treatAbnormalNum

									vm.limitProduct = res.data.productNum[0].limitProduct
									vm.stopProduct = res.data.productNum[0].stopProduct
									vm.unexecut = res.data.productNum[0].unexecut

									vm.monitorNum = res.data.enterpriseNum[0].monitorNum
									vm.enterpriseNum = res.data.enterpriseNum[0].enterpriseNum
									vm.productMonitorNum = res.data.enterpriseNum[0].productMonitorNum
									vm.treatMonitorNum = res.data.enterpriseNum[0].treatMonitorNum

									vm.reduceList = res.data.reduceList

									// 开始整理 各行业异常企业占比
									var tradeX = [];
									var tradeY = [];
									for (var i = 0; i < res.data.abnormalTradeNum.length; i++) {
										tradeX.push(res.data.abnormalTradeNum[i].name);
										tradeY.push(res.data.abnormalTradeNum[i].abnormalNum)
									}
									vm.abnormalTradeNum = {
										xAxis: {
											type: 'category',
											data: tradeX
										},
										yAxis: {
											type: 'value'
										},
										series: [{
											data: tradeY,
											type: 'bar'
										}]
									};
									
									
									// 开始整理 各区域异常企业占比
									var organizeX = [];
									var organizeY = [];
									for (var i = 0; i < res.data.abnormalOrganizeNum.length; i++) {
										organizeX.push(res.data.abnormalOrganizeNum[i].name);
										organizeY.push(res.data.abnormalOrganizeNum[i].abnormalNum)
									}
									vm.abnormalOrganizeNum = {
										xAxis: {
											type: 'category',
											data: organizeX
										},
										yAxis: {
											type: 'value'
										},
										series: [{
											data: organizeY,
											type: 'bar'
										}]
									};

									// 开始整理  产/治污设施运行情况   // todo横坐标、 纵坐标 的数据
									var monitorX = [];
									var monitorY = [];
									for (var i = 0; i < res.data.abnormalOrganizeNum.length; i++) {
										monitorX.push(res.data.startMonitorNum[i].name);
										monitorY.push(res.data.startMonitorNum[i].abnormalNum)
									}
									vm.startMonitorNum = {
										xAxis: {
											type: 'category',
											data: monitorX
										},
										yAxis: {
											type: 'value'
										},
										series: [{
											data: organizeY,
											type: 'bar'
										}]
									}

									window.layuiInit(vm.abnormalTradeNum,vm.abnormalOrganizeNum,vm.startMonitorNum);
								} else {
									vm.$notify.error({
										title: '错误',
										message: res.data.msg
									})
								}
							})
					}
				},
				mounted: function() {
					this.pageInit();
				}
			});

			function layuiInit(abnormalTradeNum,abnormalOrganizeNum,startMonitorNum) {
				layui.config({
					base: '../../layuiadmin/' //静态资源所在路径
				}).extend({
					index: 'lib/index' //主入口模块
				}).use(['index', 'table', "jquery", "echarts"], function() {
					var table = layui.table;
					var echart = layui.echarts;

					var zcharts = echart.init(document.getElementById("zchart"));
					var tradeAbnormal = echart.init(document.getElementById("tradeAbnormal"));
					var organizeAbnormal = echart.init(document.getElementById("organizeAbnormal"));
					var startMonitor = echart.init(document.getElementById("startMonitor"));

					table.render({
						elem: '#demo',
						height: 300,
						// ,url: '/demo/table/user/' //数据接口
						page: false, //开启分页
						data: vm.reduceList,
						cols: [
							[ //表头
								{
									field: 'enterpriseName',
									title: '企业名称',
									width: '60%'
								}, {
									field: 'TradeName',
									title: '行业'
								}, {
									field: 'ProduceType',
									title: '停限产'
								}
							]
						]
					});


					tradeAbnormal.setOption(abnormalTradeNum); //各行业异常企业占比 表格
					organizeAbnormal.setOption(abnormalOrganizeNum); //各行业异常企业占比 表格
					startMonitor.setOption(startMonitorNum); //各行业异常企业占比 表格

					options = {
						xAxis: {
							type: 'category',
							data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
						},
						yAxis: {
							type: 'value'
						},
						grid: {
							x: 50,
							y: 5,
							x2: 5,
							y2: 20,
							borderWidth: 1
						},
						series: [{
							data: [820, 932, 901, 934, 1290, 1330, 1320],
							type: 'line'
						}]
					};
					zcharts.setOption(options);

				});
			}
		</script>
	</body>

</html>
